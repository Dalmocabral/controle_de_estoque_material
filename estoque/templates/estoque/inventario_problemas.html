{% extends 'base/base_dashboard.html' %}

{% block title %}Inventário com Problemas{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Inventários com Problemas</h2>

    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Imagem</th>
                <th>Nome da Peça</th>
                <th>Indetificação</th>
                <th>Data do Inventário</th>
                <th>Status</th>
                <th>Problemas</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody>
            {% for inventario in inventarios %}
                <tr>
                    <!-- Imagem -->
                    <td style="width: 120px;">
                        {% if inventario.equipamento.foto %}
                            <img src="{{ inventario.equipamento.foto.url }}" class="img-thumbnail" style="max-height: 100px;">
                        {% else %}
                            <span class="text-muted">Sem imagem</span>
                        {% endif %}
                    </td>

                    <!-- Nome da Peça -->
                    <td>{{ inventario.equipamento.equipamento }}</td>

                    <!-- Identificação -->
                    <td>{{ inventario.equipamento.identificador }}</td>

                    <!-- Data do Inventário -->
                    <td>{{ inventario.data_inventario|date:"d/m/Y H:i" }}</td>

                    <!-- Status -->
                    <td>
                        {% if inventario.equipamento.status == 'DESCARTADO' %}
                            <span class="badge bg-dark">Descartado</span>
                        {% elif inventario.descarte %}
                            <span class="badge bg-danger">Aguardando confirmação</span>
                        {% else %}
                            <span class="badge bg-warning">Pendente</span>
                        {% endif %}
                    </td>

                    <!-- Problemas -->
                    <td>
                        {% if inventario.avaria %}<span class="badge bg-warning">Avaria</span>{% endif %}
                        {% if inventario.perda %}<span class="badge bg-danger">Perda</span>{% endif %}
                        {% if inventario.nao_devolvido %}<span class="badge bg-secondary">Não devolvido</span>{% endif %}
                    </td>

                    <!-- Botão de Detalhes -->
                    <td>
                        {% if inventario.equipamento.status != 'DESCARTADO' %}
                            <a href="{% url 'inventario_detalhe' inventario.id %}" class="btn btn-sm btn-outline-primary">Detalhes</a>
                        {% else %}
                            <button class="btn btn-sm btn-outline-secondary" disabled>Finalizado</button>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6" class="text-center">Nenhum inventário com problemas encontrado.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}